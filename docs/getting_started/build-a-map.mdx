---
title: Build a Basemap
---

import CodeBlock from '@theme/CodeBlock';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Building a Basemap from Overture Data

### Placeholder < Map Here >

### < Map Here >

### < Map Here >

### < Map Here >

### Step 1: Download the Data

Because Overture data is released as a single collection of data in a cloud-native format (parquet), interfacing with the data through a service that can take advantage of the cloud-native properties of the data.

The queries presented here are meant to run in Amazon Athena against the `overture_2023_10_19_alpha_0` table, as set up in [these instructions](https://github.com/OvertureMaps/data#accessing-overture-maps-data-1).

Below are different queries for each theme that extract only the relevant attributes for each feature within a specific bounding box. In this case, Seattle, Washington, USA. Each Athena query produces a `CSV` file which can be turned into `GeoJSON` file using [DuckDB](https://duckdb.org/) and then run through [tippecanoe](https://github.com/felt/tippecanoe) to produce a [`PMTiles`](https://github.com/protomaps/PMTiles) archive:

<Tabs queryString="athena-query" >
<TabItem value="buildings" label="Buildings" default>

1. Athena query to produce `buildings.csv`:

    ```sql
    SELECT class,
        TRY(FILTER(names.common, x -> x.language = 'local')[1].value) as local_name,
        height,
        level,
        CAST(sources AS JSON) as sources,
        ST_ASTEXT(ST_GeomFromBinary(geometry)) as geometry_wkt
    FROM overture_2023_10_19_alpha_0
    WHERE theme = 'buildings' AND type = 'building'
        AND bbox.minX > -122.679404 AND bbox.maxX < -121.978275
        AND bbox.minY > 47.360619 AND bbox.maxY < 47.786336
    ```

2. Use DuckDB to convert `buildings.csv` into a GeoJSONSeq file.

    <details><summary>DuckDB Query ( <code>SQL</code> )</summary>

    ```sql
    COPY (
        SELECT
            "class",
            "local_name",
            "height",
            "level",
            "sources",
            ST_GeomFromText(geometry_wkt) as geometry
        FROM read_csv('csv/buildings.csv', header=True,
            COLUMNS={
                'class':'VARCHAR',
                'local_name':'VARCHAR',
                'height':'DOUBLE',
                'level':'VARCHAR',
                'sources':'VARCHAR',
                'geometry_wkt':'VARCHAR'
            }
        )
        ) TO 'geojson/buildings.geojsonseq'
    WITH (FORMAT GDAL, DRIVER 'GeoJSONSeq');
    ```

    </details>

3. Run [tippecanoe](https://github.com/felt/tippecanoe) to produce a `pmtiles` archive from `buildings.geojsonseq`

    ```bash
    tippecanoe -o tiles/buildings.pmtiles -Z13 -z13 -l buildings -P geojson/buildings.geojsonseq
    ```

    <details><summary>Tippecanoe flag explanation</summary>

    - `-o tiles/buildings.pmtiles` is our output file.
    - `-Z13` and `-z13` will produce a tileset starting at zoom 13 and going up to zoom 13 (so only 1 zoom level).
    - `-l buildings` names the layer "buildings"
    - `-P` allows tippecanoe to read the file in parallel. Since we created a GeoJSON sequence file instead of a single GeoJSON Feature Collection, tippecanoe can process the input data more efficiently.

    </details>

</TabItem>

<!-- Roads -->

<TabItem value="roads" label="Roads" default>

1. Athena query to produce `roads.csv`:

    ```sql
    SELECT
        level,
        JSON_EXTRACT_SCALAR(road, '$.class') AS road_class,
        JSON_EXTRACT_SCALAR(road, '$.roadNames.common[0].value') AS road_name,
        sources[1].dataset AS source,
        ST_ASTEXT(ST_GeomFromBinary(geometry)) as geometry_wkt
    FROM overture_2023_10_19_alpha_0
    WHERE theme = 'transportation' AND type = 'segment'
        AND bbox.minX > -122.679404 AND bbox.maxX < -121.978275
        AND bbox.minY > 47.360619 AND bbox.maxY < 47.786336
    ```

2. Use DuckDB to convert `roads.csv` into a GeoJSONSeq file.

    ```sql
    COPY (
        SELECT
            road_class as class,
            road_name as name,
            level,
            ST_GeomFromText(geometry_wkt) as geometry
        FROM 'csv/roads.csv'
        ) TO 'geojson/roads.geojsonseq'
    WITH (FORMAT GDAL, DRIVER 'GeoJSONSeq');
    ```

3. Run [tippecanoe](https://github.com/felt/tippecanoe) to produce a `pmtiles` archive from `roads.geojsonseq`

    ```bash
    tippecanoe -o tiles/roads.pmtiles -Z10 -B10 -z13 -l roads -P geojson/roads.geojsonseq
    ```

    <details><summary>Tippecanoe flag explanation</summary>

    - `-o tiles/roads.pmtiles` is our output file.
    - `-Z10` and `-z13` will produce a tileset starting at zoom 10 and going up to zoom 13.
    - `-B10` will ensure that all featuers are present from zoom level 10.
    - `-l roads` names the layer "roads"
    - `-P` allows tippecanoe to read the file in parallel. Since we created a GeoJSON sequence file instead of a single GeoJSON Feature Collection, tippecanoe can process the input data more efficiently.

    </details>

</TabItem>

<!-- Places -->

<TabItem value="places" label="Places" default>

1. Athena query to produce `places.csv`:

    ```sql
    SELECT
        TRY(
            FILTER(names.common, x->x.language = 'local') [ 1 ].value
        ) as local_name,
       categories.main as category,
       ROUND(confidence,2) as confidence,
       TRY(websites[1]) AS url,
       TRY(addresses[1]) AS address,
       sources[1] as source,
       ST_ASTEXT(ST_GeomFromBinary(geometry)) as geometry_wkt
    FROM overture_2023_10_19_alpha_0
    WHERE theme = 'places' AND type = 'place'
        AND bbox.minX > -122.679404 AND bbox.maxX < -121.978275
        AND bbox.minY > 47.360619 AND bbox.maxY < 47.786336
    ```

2. Use DuckDB to convert `places.csv` into a GeoJSONSeq file.

    ```sql
    COPY (
    SELECT
        local_name as name,
        confidence, category, url, address, source,
        ST_GeomFromText(geometry_wkt) as geometry
    FROM 'csv/places.csv'
    ) TO 'geojson/places.geojsonseq'
    WITH (FORMAT GDAL, DRIVER 'GeoJSONSeq', SRS 'EPSG:4326');
    ```

3. Run [tippecanoe](https://github.com/felt/tippecanoe) to produce a `pmtiles` archive from `places.geojsonseq`

    ```bash
    tippecanoe -fo tiles/places.pmtiles -Z13 -z13 -l places -P geojson/places.geojsonseq
    ```

    <details><summary>Tippecanoe flag explanation</summary>

    - `-fo tiles/places.pmtiles` is our output file, which we can overwrite (f) if it exists.
    - `-Z13` and `-z13` will produce a tileset starting at zoom 13 and going up to zoom 13 (so only 1 zoom level).
    - `-l places` names the layer "buildings"
    - `-P` allows tippecanoe to read the file in parallel. Since we created a GeoJSON sequence file instead of a single GeoJSON Feature Collection, tippecanoe can process the input data more efficiently.

    </details>

</TabItem>

<!-- Water -->

<TabItem value="water" label="Water" default>

1. Athena query to produce `water.csv`:

    ```sql
    SELECT
        subType,
        class,
        TRY(FILTER(names.common, x -> x.language = 'local')[1].value) as name,
        height,
        ST_ASTEXT(ST_GeomFromBinary(geometry)) as geometry_wkt
    FROM overture_2023_10_19_alpha_0
    WHERE theme = 'base' AND type = 'water' AND subType in ('ocean','lake','river')
        AND bbox.minX > -122.679404 AND bbox.maxX < -121.978275
        AND bbox.minY > 47.360619 AND bbox.maxY < 47.786336
    ```

2. Use DuckDB to convert `water.csv` into a GeoJSON file (using GeoJSON instead of GeoJSONSeq purely as an example).

    ```sql
    COPY (
        SELECT
            subType, class, name,
            ST_GeomFromText(geometry_wkt) as geometry
        FROM read_csv('csv/water.csv', auto_detect=True)
        ) TO 'geojson/water.geojson'
    WITH (FORMAT GDAL, DRIVER 'GeoJSON', SRS 'EPSG:4326');
    ```

3. Run [tippecanoe](https://github.com/felt/tippecanoe) to produce a `pmtiles` archive from `water.geojson`

    ```bash
    tippecanoe -o tiles/water.pmtiles -Z8 -z10 -l buildings geojson/water.geojson
    ```

    <details><summary>Tippecanoe flag explanation</summary>

    - `-o tiles/water.pmtiles` is our output file.
    - `-Z8` and `-z13` will produce a tileset starting at zoom 8 and going up to zoom 12.
    - `-l water` names the layer "buildings"

    </details>

</TabItem>

<TabItem value="placenames" label="Placenames" default>

1. Athena query to produce `placenames.csv`:

    ```sql
    SELECT
        subType,
        localityType,
        TRY(FILTER(names.common, x -> x.language = 'local')[1].value) as local_name,
        adminLevel,
        ST_ASTEXT(ST_CENTROID(ST_GeomFromBinary(geometry))) as geometry_wkt
    FROM overture_2023_10_19_alpha_0
    WHERE theme = 'admins' AND type = 'locality'
        AND bbox.minX > -122.679404 AND bbox.maxX < -121.978275
        AND bbox.minY > 47.360619 AND bbox.maxY < 47.786336
    ```


2. Use DuckDB to convert `placenames.csv` into a GeoJSON file.

    ```sql
   COPY (
       SELECT
           localityType,
           local_name as name,
           adminlevel,
           ST_GeomFromText(geometry_wkt) as geometry
       FROM read_csv_auto('csv/placenames.csv')
   ) TO 'geojson/placenames.geojson'
   WITH (FORMAT GDAL, DRIVER 'GeoJSON', SRS 'EPSG:4326');
    ```

3. Run [tippecanoe](https://github.com/felt/tippecanoe) to produce a `pmtiles` archive from `placenames.geojson`

    ```bash
    tippecanoe -o tiles/placenames.pmtiles -Z5 -z10 -l buildings geojson/placenames.geojson
    ```

    <details><summary>Tippecanoe flag explanation</summary>

    - `-o tiles/buildings.pmtiles` is our output file.
    - `-Z5` and `-z10` will produce a tileset starting at zoom 5 and going up to zoom 13.
    - `-l placenames` names the layer "buildings"

    </details>

</TabItem>

<TabItem value="landuse" label="Land Use" default>

1. Query the buildings theme using Amazon Athena and download the results as a CSV file, `buildings.csv`:

    <details><summary>Athena Query ( <code>SQL</code> )</summary>

    ```sql
    SELECT class,
        TRY(FILTER(names.common, x -> x.language = 'local')[1].value) as local_name,
        height,
        level,
        CAST(sources AS JSON) as sources,
        ST_ASTEXT(ST_GeomFromBinary(geometry)) as geometry_wkt
    FROM overture_2023_10_19_alpha_0
    WHERE theme = 'buildings'
        AND type = 'building'
        AND bbox.minX > -122.679404
        AND bbox.maxX < -121.978275
        AND bbox.minY > 47.360619
        AND bbox.maxY < 47.786336
    ```

    </details>

2. Use DuckDB to convert `buildings.csv` into a GeoJSONSeq file.

    <details><summary>DuckDB Query ( <code>SQL</code> )</summary>

    ```sql
    COPY (
        SELECT
            "class",
            "local_name",
            "height",
            "level",
            "sources",
            ST_GeomFromText(geometry_wkt) as geometry
        FROM read_csv('csv/buildings.csv', header=True,
            COLUMNS={
                'class':'VARCHAR',
                'local_name':'VARCHAR',
                'height':'DOUBLE',
                'level':'VARCHAR',
                'sources':'VARCHAR',
                'geometry_wkt':'VARCHAR'
            }
        )
        ) TO 'geojson/buildings.geojsonseq'
    WITH (FORMAT GDAL, DRIVER 'GeoJSONSeq');
    ```

    </details>

3. Run [tippecanoe](https://github.com/felt/tippecanoe) to produce a `pmtiles` archive from `buildings.geojsonseq`

    ```bash
    tippecanoe -o tiles/placenames.pmtiles -Z13 -z13 -l buildings -P geojson/buildings.geojsonseq
    ```

    <details><summary>Tippecanoe flag explanation</summary>

    - `-o tiles/buildings.pmtiles` is our output file.
    - `-Z13` and `-z13` will produce a tileset starting at zoom 13 and going up to zoom 13 (so only 1 zoom level).
    - `-l buildings` names the layer "buildings"
    - `-P` allows tippecanoe to read the file in parallel. Since we created a GeoJSON sequence file instead of a single GeoJSON Feature Collection, tippecanoe can process the input data more efficiently.

    </details>

</TabItem>

</Tabs>

### Part 2: Make a map with maplibre
